	AREA Schedule, CODE
	
	EXPORT schedule_process
	
	; void schedule_process(PCB *proc);
schedule_process
	; r0 contains PCB we want to jump into.

	; Drop to user mode
	msr CPSR_c, #0x10	
	
	; Move the PCB to the LR and load it into user mode
	mov lr, r0
	; Move the LR to the start of the Regs
	add lr, lr, #8
	
	LDR r0, [lr], #4
	LDR r1, [lr], #4
	LDR r2, [lr], #4
	LDR r3, [lr], #4
	LDR r4, [lr], #4
	LDR r5, [lr], #4
	LDR r6, [lr], #4
	LDR r7, [lr], #4
	LDR r8, [lr], #4
	LDR r9, [lr], #4
	LDR r10,[lr], #4
	LDR r11,[lr], #4
	LDR r12,[lr], #4
	LDR r13,[lr], #8
	LDR r15,[lr]
	
		

	
	END
	
